<!doctype html>
<html class="OrderExtend">

	<head>
		<meta charset="utf-8">
		<meta name="msapplication-tap-highlight" content="no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1, user-scalable=no">
		<title>贵点</title>
		<link href="mui/mui.min.css" rel="stylesheet" type="text/css" />
		<link href="css/main.css" rel="stylesheet" type="text/css" />
		<script src="js/fastclick.js"></script>
		<script src="js/jquery.min.js"></script>
	</head>

	<body class="OrderExtend">
		<!--公共头部 begin-->
		<div class="header">
			<div class="goback">
				<a class="mui-action-back" href="javascript:void(0);" onclick="javascript :history.back(-1);"><img src="images/goback.png" /></a>
			</div>
			<h2>推广订单</h2>
		</div>
		<!--公共头部 end-->

		<!--主体 begin-->
		<div class="Conter page-slideright">
			<div class="Selectbox mui-bar-tab">
				<div class="mui-table-view-cell mui-collapse">
					<a class="mui-navigate-right" href="javascript:void(0);">所有状态</a>
					<div class="mui-collapse-content">
						<a class="Allstatus mui-tab-item mui-active" href="#Allstatus">所有状态</a>
						<a class="stayPay mui-tab-item" href="#stayPay">待付款</a>
						<a class="Payed mui-tab-item" href="#Payed">已付款</a>
						<a class="Counted mui-tab-item" href="#Counted">已结算</a>
					</div>
				</div>
				<div class="OrderList mui-content">
					<div class="Listbox mui-control-content mui-active" id="Allstatus">
						<!--<section class="orderli">
							<div class="order-t">
								<div class="imgbox"><img src="images/GoodsIntr.jpg"></div>
								<div class="intro">
									<h3>优选夏黑有机葡萄 1000g×10件</h3>
									<h4>所属推广人：<span>本人</span></h4>
									<p>
										<a href="" class="orderstatus orderpayed">已付款</a>
									</p>
								</div>
							</div>
							<div class="order-m">
								<p>付款金额：¥<span class="paynumb">398.00</span></p>
								<p>预估推广收入：¥<span class="extendnumb">398.00</span></p>
							</div>
							<div class="order-b">
								<p><span>2017-07-13 21:45</span>创建</p>
							</div>
						</section>			-->
					</div>
					<div class="Listbox mui-control-content" id="stayPay">
						<!--<section class="orderli">
							<div class="order-t">
								<div class="imgbox"><img src="images/GoodsIntr.jpg"></div>
								<div class="intro">
									<h3>优选夏黑有机葡萄 1000g×10件</h3>
									<h4>所属推广人：<span>本人</span></h4>
									<p>
										<a href="" class="orderstatus orderstayPay">待付款</a>
									</p>
								</div>
							</div>
							<div class="order-m">
								<p>付款金额：¥<span class="paynumb">398.00</span></p>
								<p>预估推广收入：¥<span class="extendnumb">398.00</span></p>
							</div>
							<div class="order-b">
								<p><span>2017-07-13 21:45</span>创建</p>
							</div>
						</section>-->
					</div>
					<div class="Listbox mui-control-content" id="Payed">
						<!--<section class="orderli">
							<div class="order-t">
								<div class="imgbox"><img src="images/GoodsIntr.jpg"></div>
								<div class="intro">
									<h3>优选夏黑有机葡萄 1000g×10件</h3>
									<h4>所属推广人：<span>本人</span></h4>
									<p>
										<a href="" class="orderstatus orderpayed">已付款</a>
									</p>
								</div>
							</div>
							<div class="order-m">
								<p>付款金额：¥<span class="paynumb">398.00</span></p>
								<p>预估推广收入：¥<span class="extendnumb">398.00</span></p>
							</div>
							<div class="order-b">
								<p><span>2017-07-13 21:45</span>创建</p>
							</div>
						</section>-->
					</div>
					<div class="Listbox mui-control-content" id="Counted">
						<!--<section class="orderli">
							<div class="order-t">
								<div class="imgbox"><img src="images/GoodsIntr.jpg"></div>
								<div class="intro">
									<h3>优选夏黑有机葡萄 1000g×10件</h3>
									<h4>所属推广人：<span>本人</span></h4>
									<p>
										<a href="" class="orderstatus ordercounted">已结算</a>
									</p>
								</div>
							</div>
							<div class="order-m">
								<p>付款金额：¥<span class="paynumb">398.00</span></p>
								<p>预估推广收入：¥<span class="extendnumb">398.00</span></p>
							</div>
							<div class="order-b">
								<p><span>2017-07-13 21:45</span>创建</p>
							</div>
						</section>-->
					</div>
				</div>
			</div>
			<div class="backmask"></div>
		</div>
		<!--主体 end-->

		<script src="mui/mui.min.js"></script>
		<script src="js/mui.slideright.js"></script>
		<script src="js/ajax/commonfuc.js"></script>
		<script>
			window.onload = function searchSS() {
				FastClick.attach(document.body); //ios点击优化
			};

			var hidemaskbtn = document.querySelector(".mui-collapse");
			var backmask = document.querySelector(".backmask");
			var showmask = document.querySelector(".mui-navigate-right");
			var collapsecont = document.querySelector('.mui-collapse-content');
			var oClass = 'show';

			function hideMask() {
				hidemaskbtn.classList.remove('mui-active');
				backmask.classList.remove(oClass);
				setTimeout(function() {
					backmask.style.display = "none";
				}, 300);
			}

			mui('.mui-collapse-content').on('tap', 'a', function(e) {
				hideMask();
				showmask.innerHTML = this.innerHTML;
			});

			showmask.addEventListener("tap", function() {
				if(hasClass(backmask, oClass)) {
					backmask.classList.remove(oClass);
					setTimeout(function() {
						backmask.style.display = "none";
					}, 300);
				} else {
					backmask.style.display = "block";
					setTimeout(function() {
						collapsecont.classList.add(oClass);
						backmask.classList.add(oClass);
					}, 0)
				}
			});

			var maskthis = document.querySelector(".backmask");
			maskthis.addEventListener("tap", function() {
				hideMask();
			});

			function hasClass(element, csName) {　　　
				return !!element.className.match(new RegExp("(\\s|^)" + csName + "(\\s|$)"));　　
			}
		</script>

		<script type="text/javascript">
			var wxid = localStorage.getItem("m_openid");
			mui.ajax(commonUrl + 'apigd/membershopfxorder', {
				data: {
					m_openid: wxid,
					page: 1,
					pagesize: 100
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'get', //HTTP请求类型
				timeout: 6000, //超时时间设置为6秒；
				success: function(data) {
					if(data.code == 1) {
						var Data = data.data.listdata;
						html = "";
						if(Data.length > 0) {
							for(var i = 0; i < Data.length; i++) {
								html += '<section class="orderli"><div class="order-t"><div class="imgbox"><img src="' + Data[0].goodslist[0].goods_detail.data_json.pic + '"></div>' +
									'<div class="intro"><h3>' + Data[i].goodslist[0].goods_detail.title + '</h3><h4>VIP会员购买者：<span>' + Data[i].m_nickname + '</span></h4>' +
									'<p><a class="orderstatus">' + Data[i].status_name + '</a></p></div></div><div class="order-m">' +
									'<p>付款金额：¥<span class="paynumb">' + Data[i].order_price_final + '</span></p><p>预估推广收入：¥<span class="extendnumb">' + Data[i].tc_value + '</span></p>' +
									'</div><div class="order-b"><p><span>' + Data[i].creat_at + '</span>创建</p></div></section>'
							};
							$("#Allstatus").html(html);
							var section = document.querySelectorAll('#Allstatus .orderli');
							for(j = 0; j < Data.length; j++) {
								if(Data[j].status_name == '待付款') {
									var x = section[j].querySelector("a.orderstatus");
									x.className += " " + "orderstayPay";
								} else {
									if(Data[j].status_name == '已付款') {
										var y = section[j].querySelector("a.orderstatus");
										y.className += " " + "orderpayed";
									} else {
										var z = section[j].querySelector("a.orderstatus");
										z.className += " " + "ordercounted";
									}
								}
							}
						} else {
							mui.toast('没有更多数据');
						};
					} else {
						mui.toast("您还没有下级分销商");
					};
				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					mui.toast(RequestErrorMsg(type));
				}
			});
			document.querySelector('.stayPay').addEventListener('tap', function() {
				oreder(1, 'orderstayPay', "#stayPay");
			});
			document.querySelector('.Payed').addEventListener('tap', function() {
				oreder(2, 'orderpayed', "#Payed");
			});
			document.querySelector('.Counted').addEventListener('tap', function() {
				oreder(3, 'ordercounted', "#Counted");
			});

			function oreder(status, order, pay) {
				mui.ajax(commonUrl + 'apigd/membershopfxorder', {
					data: {
						m_openid: wxid,
						status: status,
						page: 1,
						pagesize: 100
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'get', //HTTP请求类型
					timeout: 6000, //超时时间设置为6秒；
					success: function(data) {
						if(data.code == 1) {
							var Data = data.data.listdata;
							html = "";
							if(Data.length > 0) {
								for(var i = 0; i < Data.length; i++) {
									html += '<section class="orderli"><div class="order-t"><div class="imgbox"><img src="' + Data[0].goodslist[0].goods_detail.data_json.pic + '"></div>' +
										'<div class="intro"><h3>' + Data[i].goodslist[0].goods_detail.title + '</h3><h4>分销购买者：<span>' + Data[i].m_nickname + '</span></h4>' +
										'<p><a class="orderstatus ' + order + '">' + Data[i].status_name + '</a></p></div></div><div class="order-m">' +
										'<p>付款金额：¥<span class="paynumb">' + Data[i].order_price_final + '</span></p><p>预估推广收入：¥<span class="extendnumb">' + Data[i].tc_value + '</span></p>' +
										'</div><div class="order-b"><p><span>' + Data[i].creat_at + '</span>创建</p></div></section>'
								};
								$(pay).html(html);
							} else {
								mui.toast('没有更多数据');
							};
						} else {
							mui.toast("网络错误");
						}
					},
					error: function(xhr, type, errorThrown) {
						//异常处理；
						mui.toast(RequestErrorMsg(type));
					}
				});
			}
		</script>
	</body>

</html>